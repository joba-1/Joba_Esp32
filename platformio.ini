; platformio.ini

[platformio]
default_envs = serial

; ============================================
; Shared configuration for all environments
; ============================================
[env]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/54.03.20/platform-espressif32.zip
board = esp32dev
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
board_build.partitions = min_spiffs.csv

; Library dependencies
lib_deps = 
    tzapu/WiFiManager@^2.0.17
    me-no-dev/ESPAsyncWebServer@^1.2.4
    me-no-dev/AsyncTCP@^1.1.1
    bblanchon/ArduinoJson@^7.0.0
    knolleary/PubSubClient@^2.8

; Common build flags
build_flags = 
    ; Logging configuration
    -D LOG_BAUD_RATE=${env.monitor_speed}
    -D LOG_SERIAL_BOOT_LEVEL=4
    -D LOG_SERIAL_RUNTIME_LEVEL=3
    -D LOG_BOOT_DURATION_MS=30000
    -D LOG_SYSLOG_LEVEL=3
    -D LOG_SYSLOG_SERVER=\"\"
    -D LOG_SYSLOG_PORT=514
    -D LOG_ENABLE_TIMESTAMP=true
    
    ; WiFi configuration
    -D WIFI_AP_NAME=\"ESP32-Config\"
    -D WIFI_AP_PASSWORD=\"\"
    -D WIFI_CONFIG_PORTAL_TIMEOUT=180
    
    ; NTP / Time configuration
    -D NTP_SERVER1=\"pool.ntp.org\"
    -D NTP_SERVER2=\"time.nist.gov\"
    -D TIMEZONE=\"CET-1CEST,M3.5.0,M10.5.0/3\"
    -D NTP_SYNC_INTERVAL=3600000
    
    ; Web server configuration
    -D WEBSERVER_PORT=80
    -D WEBSERVER_USERNAME=\"admin\"
    -D WEBSERVER_PASSWORD=\"admin\"
    
    ; OTA configuration
    -D OTA_HOSTNAME=\"esp32-device\"
    -D OTA_PASSWORD=\"otapassword\"
    -D OTA_PORT=3232
    
    ; InfluxDB 1.x configuration (user/password auth)
    -D INFLUXDB_URL=\"\"
    -D INFLUXDB_VERSION=1
    -D INFLUXDB_DATABASE=\"\"
    -D INFLUXDB_USERNAME=\"\"
    -D INFLUXDB_PASSWORD=\"\"
    -D INFLUXDB_RP=\"\"
    -D INFLUXDB_BATCH_INTERVAL=10000
    -D INFLUXDB_BATCH_SIZE=50
    
    ; InfluxDB 2.x configuration (token auth) - uncomment to use instead of 1.x
    ; -D INFLUXDB_VERSION=2
    ; -D INFLUXDB_ORG=\"my-org\"
    ; -D INFLUXDB_BUCKET=\"my-bucket\"
    ; -D INFLUXDB_TOKEN=\"my-token\"
    
    ; MQTT configuration
    -D MQTT_SERVER=\"\"
    -D MQTT_PORT=1883
    -D MQTT_USERNAME=\"\"
    -D MQTT_PASSWORD=\"\"
    -D MQTT_BASE_TOPIC=\"esp32\"
    -D MQTT_RECONNECT_INTERVAL=5000

; ============================================
; Serial upload environment
; ============================================
[env:serial]
upload_protocol = esptool
upload_port = /dev/ttyUSB0
; Alternatively auto-detect:
; upload_port = /dev/ttyUSB*

; ============================================
; OTA upload environment
; ============================================
[env:ota]
upload_protocol = espota
upload_port = esp32-device.local
; Or use IP address:
; upload_port = 192.168.1.100
upload_flags = 
    --port=3232
    --auth=otapassword
